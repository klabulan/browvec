<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalRetrieve MVP Demo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>LocalRetrieve MVP Demo</h1>
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-label">Database:</span>
                    <span id="db-status" class="status-value disconnected">Disconnected</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Query Time:</span>
                    <span id="query-time" class="status-value">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Memory:</span>
                    <span id="memory-usage" class="status-value">-</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Left Panel: Data Management -->
        <section class="panel left-panel">
            <h2>Data Management</h2>

            <!-- Database Info -->
            <div class="section">
                <h3>Database Info</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Size:</span>
                        <span id="db-size" class="info-value">0 KB</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Documents:</span>
                        <span id="doc-count" class="info-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Storage:</span>
                        <span id="storage-type" class="info-value">Memory</span>
                    </div>
                </div>
            </div>

            <!-- Import/Export -->
            <div class="section">
                <h3>Import/Export</h3>
                <div class="import-export">
                    <div class="file-input-wrapper">
                        <input type="file" id="import-file" accept=".db,.sqlite,.sql" style="display: none;">
                        <button id="import-btn" class="btn secondary">Import Database</button>
                    </div>
                    <button id="export-btn" class="btn secondary">Export Database</button>
                    <div id="transfer-progress" class="progress-bar" style="display: none;">
                        <div class="progress-fill"></div>
                        <span class="progress-text">0%</span>
                    </div>
                </div>
            </div>

            <!-- Test Data -->
            <div class="section">
                <h3>Test Data</h3>
                <div class="button-group">
                    <button id="load-sample-btn" class="btn primary">Load Sample Data</button>
                    <button id="clear-db-btn" class="btn warning">Clear All Data</button>
                    <button id="recreate-db-btn" class="btn danger">Recreate Database</button>
                </div>
                <div id="sample-status" class="status-message"></div>
            </div>
        </section>

        <!-- Center Panel: Embedding Configuration -->
        <section class="panel center-panel">
            <h2>Embedding Configuration</h2>

            <!-- Provider Selection -->
            <div class="section">
                <h3>Embedding Provider</h3>
                <div class="embedding-provider">
                    <div class="input-group">
                        <label for="embedding-provider">Provider:</label>
                        <select id="embedding-provider" class="provider-select">
                            <option value="transformers">Transformers.js (Local)</option>
                            <option value="openai">OpenAI API</option>
                        </select>
                    </div>
                    <div id="provider-status" class="provider-status">
                        <span class="status-indicator">‚óè</span>
                        <span class="status-text">Local processing - No API key required</span>
                    </div>
                </div>
            </div>

            <!-- OpenAI Configuration -->
            <div class="section" id="openai-config" style="display: none;">
                <h3>OpenAI Configuration</h3>
                <div class="openai-settings">
                    <div class="input-group">
                        <label for="openai-api-key">API Key:</label>
                        <div class="api-key-wrapper">
                            <input type="password" id="openai-api-key" placeholder="sk-..." class="api-key-input">
                            <button id="test-api-key" class="btn small" disabled>Test Connection</button>
                        </div>
                        <small class="input-hint">Your API key is not stored and is only used for this session</small>
                    </div>

                    <div class="input-group">
                        <label for="openai-model">Model:</label>
                        <select id="openai-model">
                            <option value="text-embedding-3-small">text-embedding-3-small</option>
                            <option value="text-embedding-3-large">text-embedding-3-large</option>
                            <option value="text-embedding-ada-002">text-embedding-ada-002</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="embedding-dimensions">Dimensions:</label>
                        <select id="embedding-dimensions">
                            <option value="384">384 (Compact)</option>
                            <option value="768">768 (Balanced)</option>
                            <option value="1536">1536 (Full)</option>
                        </select>
                        <small class="input-hint">Higher dimensions may provide better accuracy but use more storage</small>
                    </div>
                </div>
            </div>

            <!-- Collection Configuration -->
            <div class="section">
                <h3>Collection Configuration</h3>
                <div class="collection-config">
                    <div class="input-group">
                        <label for="collection-name">Collection Name:</label>
                        <input type="text" id="collection-name" value="default" placeholder="Enter collection name">
                    </div>

                    <div class="input-group">
                        <label for="collection-description">Description (optional):</label>
                        <input type="text" id="collection-description" placeholder="Describe this collection">
                    </div>

                    <div class="button-group">
                        <button id="create-collection-btn" class="btn primary">Create Collection</button>
                        <button id="list-collections-btn" class="btn secondary">List Collections</button>
                        <button id="collection-status-btn" class="btn secondary">Collection Status</button>
                    </div>
                </div>
            </div>

            <!-- Phase 5: Queue Management -->
            <div class="section">
                <h3>Embedding Queue Management <span class="badge">Phase 5</span></h3>
                <div class="queue-management">
                    <div class="queue-controls">
                        <div class="input-group">
                            <label for="queue-collection">Target Collection:</label>
                            <input type="text" id="queue-collection" value="default" placeholder="Collection name">
                        </div>

                        <div class="input-group">
                            <label for="queue-text">Text Content:</label>
                            <textarea id="queue-text" placeholder="Enter text to enqueue for embedding..." rows="3"></textarea>
                        </div>

                        <div class="input-group">
                            <label for="queue-priority">Priority:</label>
                            <select id="queue-priority">
                                <option value="1">High (1)</option>
                                <option value="2" selected>Normal (2)</option>
                                <option value="3">Low (3)</option>
                            </select>
                        </div>

                        <div class="button-group">
                            <button id="enqueue-btn" class="btn primary">Enqueue Embedding</button>
                            <button id="process-queue-btn" class="btn secondary">Process Queue</button>
                            <button id="queue-status-btn" class="btn info">Queue Status</button>
                            <button id="clear-queue-btn" class="btn warning">Clear Queue</button>
                        </div>
                    </div>

                    <div class="queue-status" id="queue-status-display">
                        <h4>Queue Status</h4>
                        <div class="status-grid">
                            <div class="status-item">
                                <span class="status-label">Total Items:</span>
                                <span class="status-value" id="queue-total">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Pending:</span>
                                <span class="status-value" id="queue-pending">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Processing:</span>
                                <span class="status-value" id="queue-processing">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Completed:</span>
                                <span class="status-value" id="queue-completed">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Failed:</span>
                                <span class="status-value" id="queue-failed">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="queue-results" id="queue-results">
                        <div class="results-placeholder">Queue operations will appear here...</div>
                    </div>
                </div>
            </div>

            <!-- LLM Integration (SCRUM-17) -->
            <div class="section">
                <h3>LLM Integration <span class="badge">SCRUM-17</span></h3>
                <div class="llm-integration">
                    <div class="input-group">
                        <label for="llm-provider">LLM Provider:</label>
                        <select id="llm-provider">
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="openrouter">OpenRouter</option>
                            <option value="custom">Custom Endpoint (OpenAI-compatible)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="llm-model">Model:</label>
                        <input type="text" id="llm-model" placeholder="gpt-4, claude-3-sonnet, etc." value="gpt-4">
                    </div>

                    <div class="input-group" id="llm-endpoint-group" style="display: none;">
                        <label for="llm-endpoint">Endpoint URL:</label>
                        <input type="text" id="llm-endpoint" placeholder="https://your-api.com/v1/chat/completions">
                    </div>

                    <div class="input-group">
                        <label for="llm-api-key">API Key:</label>
                        <input type="password" id="llm-api-key" placeholder="Your API key (not stored)">
                    </div>

                    <div class="input-group">
                        <label for="llm-prompt">Prompt:</label>
                        <textarea id="llm-prompt" placeholder="Enter your prompt..." rows="4">Explain quantum computing in simple terms suitable for a 10-year-old.</textarea>
                    </div>

                    <div class="llm-controls">
                        <div class="input-group inline">
                            <label for="llm-temperature">Temperature:</label>
                            <input type="number" id="llm-temperature" min="0" max="2" step="0.1" value="0.7" style="width: 80px;">
                        </div>
                        <div class="input-group inline">
                            <label for="llm-max-tokens">Max Tokens:</label>
                            <input type="number" id="llm-max-tokens" min="50" max="4000" step="50" value="500" style="width: 100px;">
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="call-llm-btn" class="btn primary">Call LLM</button>
                        <button id="clear-llm-btn" class="btn secondary">Clear Response</button>
                    </div>

                    <div class="llm-response" id="llm-response-container" style="display: none;">
                        <h4>Response</h4>
                        <div id="llm-response-text" class="response-text"></div>
                        <div class="llm-metadata">
                            <span class="metadata-item">Model: <strong id="llm-response-model">-</strong></span>
                            <span class="metadata-item">Tokens: <strong id="llm-response-tokens">-</strong></span>
                            <span class="metadata-item">Time: <strong id="llm-response-time">-</strong></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Embedding Testing -->
            <div class="section">
                <h3>Embedding Testing</h3>
                <div class="embedding-test">
                    <div class="input-group">
                        <label for="test-text">Test Text:</label>
                        <textarea id="test-text" placeholder="Enter text to generate embeddings..." rows="3">Machine learning is a subset of artificial intelligence that focuses on algorithms.</textarea>
                    </div>

                    <div class="test-controls">
                        <button id="generate-embedding-btn" class="btn primary">Generate Embedding</button>
                        <button id="add-to-collection-btn" class="btn secondary" disabled>Add to Collection</button>
                    </div>

                    <div id="embedding-progress" class="embedding-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                            <span class="progress-text">Generating...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Embedding Results -->
            <div class="section">
                <h3>Embedding Results</h3>
                <div id="embedding-results" class="results-container">
                    <div class="results-placeholder">No embedding generated yet</div>
                </div>
                <div id="embedding-stats" class="query-stats"></div>
            </div>
        </section>

        <!-- Third Panel: SQL Operations -->
        <section class="panel third-panel">
            <h2>SQL Operations</h2>

            <!-- SQL Editor -->
            <div class="section">
                <h3>SQL Query Editor</h3>
                <div class="sql-editor">
                    <div class="editor-toolbar">
                        <select id="query-history" class="query-history">
                            <option value="">Select from history...</option>
                        </select>
                        <button id="clear-sql-btn" class="btn small">Clear</button>
                    </div>
                    <textarea id="sql-input" placeholder="Enter SQL query here...
Example:
SELECT * FROM docs_default LIMIT 5;
SELECT COUNT(*) FROM docs_default;
SELECT * FROM fts_default WHERE fts_default MATCH 'machine learning';">SELECT * FROM docs_default LIMIT 5;</textarea>
                    <button id="execute-sql-btn" class="btn primary">Execute SQL</button>
                </div>
            </div>

            <!-- SQL Results -->
            <div class="section">
                <h3>SQL Results</h3>
                <div id="sql-results" class="results-container">
                    <div class="results-placeholder">No query executed yet</div>
                </div>
                <div id="sql-stats" class="query-stats"></div>
            </div>

            <!-- LLM Testing (SCRUM-17) -->
            <div class="section">
                <h3>ü§ñ LLM Integration Testing</h3>
                <div class="llm-test">
                    <!-- Provider Configuration -->
                    <div class="input-group">
                        <label for="llm-provider">Provider:</label>
                        <select id="llm-provider" class="provider-select">
                            <option value="openai">OpenAI (GPT-4)</option>
                            <option value="openrouter" selected>OpenRouter</option>
                            <option value="anthropic">Anthropic (Claude)</option>
                            <option value="custom">Custom Endpoint</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="llm-api-key">API Key:</label>
                        <input type="password" id="llm-api-key" placeholder="Enter your API key..." />
                        <button id="load-keys-btn" class="btn small">Load from Config</button>
                    </div>

                    <!-- Query Enhancement Test -->
                    <div class="llm-section">
                        <h4>Query Enhancement</h4>
                        <div class="input-group">
                            <label for="enhance-query-input">Query:</label>
                            <input type="text" id="enhance-query-input" placeholder="search AI docs" value="search AI docs" />
                        </div>
                        <button id="enhance-query-btn" class="btn primary">Enhance Query</button>
                        <div id="enhance-query-results" class="llm-results"></div>
                    </div>

                    <!-- Result Summarization Test -->
                    <div class="llm-section">
                        <h4>Result Summarization</h4>
                        <div class="input-group">
                            <label for="summarize-search-input">Search Query:</label>
                            <input type="text" id="summarize-search-input" placeholder="javascript" value="javascript" />
                        </div>
                        <button id="summarize-results-btn" class="btn primary">Search & Summarize</button>
                        <div id="summarize-results" class="llm-results"></div>
                    </div>

                    <!-- Combined Smart Search Test -->
                    <div class="llm-section">
                        <h4>Smart Search (Combined)</h4>
                        <div class="input-group">
                            <label for="smart-search-input">Query:</label>
                            <input type="text" id="smart-search-input" placeholder="AI documentation" value="AI documentation" />
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="smart-enhance" checked /> Enhance Query
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="smart-summarize" checked /> Summarize Results
                        </label>
                        <button id="smart-search-btn" class="btn primary">Smart Search</button>
                        <div id="smart-search-results" class="llm-results"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Fourth Panel: Hybrid Search -->
        <section class="panel fourth-panel">
            <h2>Hybrid Search</h2>

            <!-- Search Interface -->
            <div class="section">
                <h3>Search Interface</h3>
                <div class="search-form">
                    <div class="input-group">
                        <label for="search-text">Text Query:</label>
                        <input type="text" id="search-text" placeholder="Enter search terms..." value="machine learning">
                    </div>

                    <div class="input-group">
                        <label for="search-vector">Vector (optional):</label>
                        <textarea id="search-vector" placeholder="[0.1, 0.2, 0.3, ...] or leave empty for text-only search" rows="3"></textarea>
                    </div>

                    <div class="search-params">
                        <div class="param-group">
                            <label for="fusion-method">Fusion Method:</label>
                            <select id="fusion-method">
                                <option value="rrf">Reciprocal Rank Fusion (RRF)</option>
                                <option value="weighted">Weighted Linear</option>
                            </select>
                        </div>

                        <div class="param-group">
                            <label for="fts-weight">FTS Weight:</label>
                            <input type="range" id="fts-weight" min="0" max="1" step="0.1" value="0.7">
                            <span id="fts-weight-value">0.7</span>
                        </div>

                        <div class="param-group">
                            <label for="vec-weight">Vector Weight:</label>
                            <input type="range" id="vec-weight" min="0" max="1" step="0.1" value="0.3">
                            <span id="vec-weight-value">0.3</span>
                        </div>

                        <div class="param-group">
                            <label for="search-limit">Result Limit:</label>
                            <input type="number" id="search-limit" min="1" max="50" value="10">
                        </div>

                        <!-- Advanced Search Options -->
                        <div class="param-group">
                            <label>
                                <input type="checkbox" id="enable-advanced-processing">
                                Enable Advanced Query Processing
                            </label>
                        </div>
                    </div>

                    <button id="search-btn" class="btn primary">Search</button>
                </div>
            </div>

            <!-- Search Results -->
            <div class="section">
                <h3>Search Results</h3>
                <div id="search-results" class="results-container">
                    <div class="results-placeholder">No search performed yet</div>
                </div>
                <div id="search-stats" class="query-stats"></div>
            </div>
        </section>

        <!-- Fifth Panel: Performance Testing -->
        <section class="panel fifth-panel">
            <h2>Performance Testing <span class="badge">Advanced</span></h2>

            <!-- Performance Test Controls -->
            <div class="section">
                <h3>Performance Test Controls</h3>
                <div class="performance-controls">
                    <div class="test-options">
                        <div class="input-group">
                            <label for="test-query-count">Test Query Count:</label>
                            <select id="test-query-count">
                                <option value="10">Quick (10 queries)</option>
                                <option value="20" selected>Standard (20 queries)</option>
                                <option value="50">Comprehensive (50 queries)</option>
                                <option value="100">Extensive (100 queries)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="test-doc-count">Test Document Count:</label>
                            <select id="test-doc-count">
                                <option value="50">Small (50 docs)</option>
                                <option value="100" selected>Medium (100 docs)</option>
                                <option value="500">Large (500 docs)</option>
                                <option value="1000">Extra Large (1000 docs)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="latency-limit">Max Additional Latency (ms):</label>
                            <input type="number" id="latency-limit" min="50" max="500" value="100" step="10">
                        </div>

                        <div class="test-flags">
                            <label>
                                <input type="checkbox" id="detailed-metrics" checked>
                                Detailed Component Metrics
                            </label>
                            <label>
                                <input type="checkbox" id="test-caching" checked>
                                Test Caching Performance
                            </label>
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="quick-perf-test-btn" class="btn primary">Quick Test</button>
                        <button id="comprehensive-perf-test-btn" class="btn secondary">Comprehensive Test</button>
                        <button id="compare-search-btn" class="btn info">Compare Search Methods</button>
                        <button id="realtime-demo-btn" class="btn accent">Real-time Demo</button>
                    </div>
                </div>
            </div>

            <!-- Performance Results -->
            <div class="section">
                <h3>Performance Test Results</h3>
                <div id="performance-results" class="results-container">
                    <div class="results-placeholder">No performance tests run yet</div>
                </div>

                <!-- Performance Metrics Display -->
                <div id="performance-metrics" class="performance-metrics" style="display: none;">
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <span class="metric-label">Test Status:</span>
                            <span id="test-status" class="metric-value">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Baseline Latency:</span>
                            <span id="baseline-latency" class="metric-value">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Enhanced Latency:</span>
                            <span id="enhanced-latency" class="metric-value">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Additional Latency:</span>
                            <span id="additional-latency" class="metric-value">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">95th Percentile:</span>
                            <span id="p95-latency" class="metric-value">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Cache Hit Rate:</span>
                            <span id="cache-hit-rate" class="metric-value">-</span>
                        </div>
                    </div>

                    <!-- Component Breakdown Chart Placeholder -->
                    <div id="component-breakdown" class="component-breakdown" style="display: none;">
                        <h4>Component Performance Breakdown</h4>
                        <div class="breakdown-bars">
                            <div class="breakdown-item">
                                <span class="breakdown-label">Query Analysis:</span>
                                <div class="breakdown-bar">
                                    <div class="breakdown-fill" id="analysis-bar"></div>
                                    <span class="breakdown-value" id="analysis-time">-</span>
                                </div>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Search Execution:</span>
                                <div class="breakdown-bar">
                                    <div class="breakdown-fill" id="search-bar"></div>
                                    <span class="breakdown-value" id="search-time">-</span>
                                </div>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Result Optimization:</span>
                                <div class="breakdown-bar">
                                    <div class="breakdown-fill" id="optimization-bar"></div>
                                    <span class="breakdown-value" id="optimization-time">-</span>
                                </div>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Analytics Tracking:</span>
                                <div class="breakdown-bar">
                                    <div class="breakdown-fill" id="analytics-bar"></div>
                                    <span class="breakdown-value" id="analytics-time">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Progress -->
            <div id="performance-progress" class="performance-progress" style="display: none;">
                <div class="progress-header">
                    <h4>Running Performance Tests...</h4>
                    <span id="progress-status">Initializing...</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="perf-progress-fill"></div>
                    <span class="progress-text" id="perf-progress-text">0%</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>LocalRetrieve MVP Demo - Hybrid Search with SQLite + sqlite-vec</p>
            <div class="tech-stack">
                <span class="tech-item">WASM</span>
                <span class="tech-item">OPFS</span>
                <span class="tech-item">Web Workers</span>
                <span class="tech-item">FTS5</span>
                <span class="tech-item">Vector Search</span>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="test-data.js"></script>
    <script src="demo.js" type="module"></script>
    <script src="performance-demo.js" type="module"></script>
</body>
</html>